# Reex 使用指南

## 应用概述

Reex 是一个使用 SwiftUI 开发的 macOS 应用程序，用于管理和执行文件夹中的命令，支持远程任务监听和执行记录上传。

## 主要功能

### 1. 文件夹列表（首页）

首页显示所有已添加的文件夹列表。

**操作：**
- 点击 "Add Folder" 按钮添加新文件夹
- 选择一个文件夹后，会在右侧显示该文件夹的详细设置
- 可以删除不需要的文件夹

### 2. 文件夹详细设置

点击文件夹后，进入内部设置页面。

**配置项：**
- **Folder Name**: 文件夹名称
- **Folder Path**: 文件夹路径（执行命令的工作目录）
- **Shell Binary**: 选择执行命令的 shell（/bin/bash, /bin/sh, /bin/zsh）
- **Monitor URL**: 任务监听链接（可选）
- **Upload Record URL**: 执行记录上传接口（可选）

### 3. 命令管理

在文件夹详细设置中，可以添加和管理命令。

**添加命令：**
1. 点击 "Add Command" 按钮
2. 输入命令名称（name）
3. 输入命令内容（cmd）
4. 可以使用 `{placeholder}` 语法添加占位符

**占位符示例：**
```bash
echo "Hello {name}"
git clone {repo_url} {target_dir}
npm install {package_name}
```

### 4. 命令执行

每个命令显示为一行，包含：
- 命令名称
- 命令内容
- 如果有占位符，会显示输入框
- 执行按钮

**执行流程：**
1. 如果命令包含占位符，填写所有占位符的值
2. 点击 "Execute" 按钮
3. 命令在新进程中执行
4. 执行结果会记录到执行记录列表

### 5. 任务监听

配置任务监听链接后，应用会每分钟拉取一次任务列表。

**任务格式（JSON）：**
```json
[
  {
    "id": "task-123",
    "name": "命令名称",
    "params": {
      "placeholder1": "值1",
      "placeholder2": "值2"
    }
  }
]
```

**自动执行规则：**
- 应用会检查最新的任务
- 如果任务 ID 未被执行过，则自动执行
- 根据任务的 `name` 匹配对应的命令
- 使用任务的 `params` 填充命令占位符

**启动监听：**
1. 配置 Monitor URL
2. 点击 "Start Monitoring" 按钮
3. 监听激活后会显示 "Monitoring active..." 状态

### 6. 执行记录

底部显示所有命令的执行记录。

**记录信息：**
- 命令名称
- 执行的完整命令
- 输出结果（stdout + stderr）
- 执行时间
- 退出代码（0 = 成功，非 0 = 失败）
- 任务 ID（如果是远程任务触发的）

**查看详情：**
- 点击记录可以查看完整的输出内容
- 可以复制输出内容

### 7. 执行记录上传

配置上传接口后，命令执行完成会自动上传结果。

**上传格式（POST JSON）：**
```json
{
  "id": "task-123",
  "output": "命令输出内容...",
  "exitCode": 0,
  "timestamp": "2026-01-15T05:30:45Z"
}
```

## 使用场景示例

### 场景 1: 本地命令快捷执行

1. 添加项目文件夹
2. 添加常用命令：
   - 构建: `npm run build`
   - 测试: `npm test`
   - 部署: `./deploy.sh {environment}`
3. 一键执行命令

### 场景 2: 远程任务执行

1. 配置文件夹和命令
2. 设置任务监听 URL
3. 启动监听
4. 远程服务器推送任务到监听接口
5. 应用自动执行任务
6. 执行结果自动上传到服务器

### 场景 3: 参数化命令

1. 创建带占位符的命令
   ```bash
   git clone {repo} && cd {repo} && npm install
   ```
2. 每次执行时填写不同的参数
3. 快速执行重复性任务

## API 服务器示例

使用提供的示例服务器测试功能：

```bash
./example-api-server.sh
```

然后在应用中配置：
- Monitor URL: `http://localhost:8080/tasks`
- Upload Record URL: `http://localhost:8080/upload`

## 数据存储

- 文件夹配置保存在 UserDefaults 中
- 每个文件夹的执行记录单独保存
- 数据持久化，重启应用后保留

## 安全性

应用使用沙箱模式，具有以下权限：
- 用户选择的文件读写访问
- 网络客户端（用于远程监听和上传）
- 每个命令在独立进程中执行

## 系统要求

- macOS 13.0 或更高版本
- Xcode 15.0 或更高版本（开发）

## 技术架构

- **框架**: SwiftUI
- **数据持久化**: UserDefaults
- **网络**: URLSession
- **进程管理**: Process (Foundation)
- **定时任务**: Timer
